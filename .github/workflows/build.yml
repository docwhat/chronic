name: build

on:
  push:
    branches:
      - "master"
    tags:
      - "!*"
  pull_request:
    branches:
      - '*'
  schedule:
    - cron: "53 22 * * 2"

jobs:
  lint:
    name: "💨 lint"
    runs-on: ubuntu-latest
    steps:
      -
        name: checkout
        uses: actions/checkout@v2
      -
        name: bootstrap
        run: |
          ./script/bootstrap
      -
        name: lint
        run: ./script/lint

  build:
    name: "⚒️ build"
    strategy:
      matrix:
        os: [ubuntu-latest, macOS-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      -
        name: get go
        uses: actions/setup-go@v2
        with:
          go-version: 1.13
      -
        name: checkout
        uses: actions/checkout@v2
      -
        name: compile
        run: |
          go run ./...

  test:
    name: "🧪 test"
    strategy:
      matrix:
        os: [ubuntu-latest, macOS-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      -
        name: get go
        uses: actions/setup-go@v2
        with:
          go-version: 1.13
      -
        name: checkout
        uses: actions/checkout@v2
      -
        name: test
        run: |
          ./script/test

  release:
    name: "🚀 release"
    runs-on: ubuntu-latest
    steps:
      -
        name: get go
        uses: actions/setup-go@v2
        with:
          go-version: 1.13
      -
        name: checkout
        uses: actions/checkout@v2
      -
        name: goreleaser
        uses: goreleaser/goreleaser-action@v2
        with:
          args: release --snapshot --skip-publish
